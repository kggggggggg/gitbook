{"./":{"url":"./","title":"Introduction","keywords":"","body":"gitbook "},"algorithm/sorting/selection_sort.html":{"url":"algorithm/sorting/selection_sort.html","title":"é€‰æ‹©æ’åº selection sort","keywords":"","body":"é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰ åŸåœ°æ’åºã€ä¸ç¨³å®š void selectionSort(int a[], int n) { for (int i = 0; i a[j]) { swap(a[i], a[j]); } } } } é€šä¿—æ˜“æ‡‚è®²è§£ é€‰æ‹©æ’åº.html void selectSort(int a[], int n) { for (int i = 0; i "},"algorithm/sorting/merge_sort.html":{"url":"algorithm/sorting/merge_sort.html","title":"å½’å¹¶æ’åº merge sort","keywords":"","body":"å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰ ä¸æ˜¯åŸåœ°æ’åºç®—æ³•ã€ç¨³å®š(ä¸»è¦çœ‹mergeå‡½æ•°) void merge(int a[],int l,int r,int mid) { int tmp[r-l+1]; int i = l, j = mid+1, k = 0; while (i =r) return; int mid=(l+r)/2; merge_sort(a,l,mid); merge_sort(a,mid+1,r); merge(a,l,r,mid); } void mergesort(int a[],int l,int r) { merge_sort(a,l,r-1); } mergeç®—æ³•ä½¿ç”¨å“¨å…µä¼˜åŒ– void merge(int a[],int l,int r,int mid) { int left[mid-l+2]; //å·¦ä¾§é•¿åº¦æ˜¯midl-l+1 å†åŠ ä¸€ä¸ªå“¨å…µ int right[r-mid+1];//å³ä¾§é•¿åº¦æ˜¯r-(mid+1)+1 å†åŠ ä¸€ä¸ªå“¨å…µ left[mid-l+1] = INT_MAX; right[r-mid] = INT_MAX; for (int i = l,k = 0; i "},"algorithm/sorting/quick_sort.html":{"url":"algorithm/sorting/quick_sort.html","title":"å¿«é€Ÿæ’åºç®—æ³• quicksort","keywords":"","body":"å¿«é€Ÿæ’åºç®—æ³•ï¼ˆQuicksortï¼‰ åŸåœ°æ’åºã€ä¸ç¨³å®š æ–¹å¼ä¸€ å› ä¸ºå›ºå®špivotæ˜¯å–å¾—å·¦è¾¹çš„å€¼ï¼Œæ‰€ä»¥whileæ—¶ï¼Œè¦å…ˆä»å³è¾¹æ‰¾ï¼› void quickSort(int a[], int head, int tail) { int low = head; int high = tail; int pivot = a[low]; while (low= a[low]) low++; a[high]=a[low]; } a[low] = pivot; if(low>head+1) quickSort(a,head,low-1); if(high æ–¹å¼äºŒ 1ã€å› ä¸ºå…ˆä»å³è¾¹æ‰¾ã€‚ 2ã€è€Œæœ€ç»ˆå› ä¸ºlow == highã€‚ 3ã€æ‰€ä»¥ç°åœ¨lowå’Œhighçš„å€¼å°äºa[head]ã€‚ 4ã€åˆ¤æ–­æ¡ä»¶ a[head] >= a[low] å¯¼è‡´a[head]ä½ç½®ä¸ä¼šå˜ ä¹Ÿå°±æ˜¯åˆ†å‰²ç‚¹ä½ç½®ä¸å˜ï¼Œå§‹ç»ˆåœ¨headä½ç½® 5ã€æ‰€ä»¥æœ€åéœ€è¦å†è¿›è¡Œä¸€æ¬¡äº¤æ¢ swap(a[low], a[head]); void quickSort(vector& a, int head, int tail) { if (head >= tail) { return; } int low = head; int high = tail; while (low= a[low]) low++; swap(a[low], a[high]); } swap(a[low], a[head]); quickSort(a,head,low-1); quickSort(a,high+1,tail); } æ–¹æ³•ä¸‰ int Paritition1(int A[], int low, int high) { int pivot = A[low]; while (low = pivot) { --high; } A[low] = A[high]; while (low "},"algorithm/sorting/bubble_sort.html":{"url":"algorithm/sorting/bubble_sort.html","title":"å†’æ³¡æ’åº bubble sort","keywords":"","body":"å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰ åŸåœ°æ’åºã€ç¨³å®š void bubbleSort(int a[], int n) { for(int i = n - 1; i > 0; i--) for(int j = 0; j a[j+1]) swap(a[j], a[j+1]); } "},"algorithm/sorting/insertion_sort.html":{"url":"algorithm/sorting/insertion_sort.html","title":"æ’å…¥æ’åº insertion sort","keywords":"","body":"æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰ åŸåœ°æ’åºã€ç¨³å®š c++æ’å…¥æ’åºç®—æ³•.html void InsertSort(int a[], int n) { for (int i = 1; i = 0 && a[j] > v) { a[j+1] = a[j]; j--; } a[j+1] = v; } } void insertionSort(int a[], int n) { if (n = 0; --j) { if (a[j] > value) { a[j+1] = a[j]; } else { break; } } a[j+1] = value; // æ’å…¥æ•°æ® } } "},"algorithm/sorting.html":{"url":"algorithm/sorting.html","title":"æ’åºç®—æ³• sorting algorithm","keywords":"","body":"ğŸ™‰ æ’åºç®—æ³•(Sorting Algorithm) å†’æ³¡æ’åº(Bubble Sort) é€‰æ‹©æ’åº(Selection Sort) æ’å…¥æ’åº(Insertion Sort) å½’å¹¶æ’åº(Merge Sort) å¿«é€Ÿæ’åº(Quick Sort) å †æ’åº(Heap Sort) æ¡¶æ’åº(Bucket sort) è®¡æ•°æ’åº(Counting Sort) åŸºæ•°æ’åº(Radix Sort) æ’åºç®—æ³•å¤§å…¨ "},"flutter/çŠ¶æ€ç®¡ç†/00å‰è¨€.html":{"url":"flutter/çŠ¶æ€ç®¡ç†/00å‰è¨€.html","title":"flutterçš„çŠ¶æ€ç®¡ç†","keywords":"","body":"Flutterçš„çŠ¶æ€ç®¡ç† å£°åå¼ç¼–ç¨‹æ¡†æ¶ å£°åå¼ç¼–ç¨‹æ¡†æ¶ï¼ˆDeclarative Programming Frameworkï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå…¶ä¸­ç¨‹åºçš„é€»è¾‘å’Œè¡Œä¸ºæ˜¯é€šè¿‡å£°æ˜å¼çš„æ–¹å¼æ¥æè¿°ï¼Œè€Œä¸æ˜¯é€šè¿‡ç¼–å†™è¯¦ç»†çš„æ§åˆ¶æµç¨‹å’ŒçŠ¶æ€å˜åŒ–çš„å‘½ä»¤å¼ä»£ç ã€‚ åœ¨å£°åå¼ç¼–ç¨‹æ¡†æ¶ä¸­ï¼Œå¼€å‘äººå‘˜ä¸»è¦å…³æ³¨ç¨‹åºçš„\"æ˜¯ä»€ä¹ˆ\"è€Œä¸æ˜¯\"å¦‚ä½•\"ï¼Œå³æè¿°ç¨‹åºçš„ç›®æ ‡å’Œæ‰€éœ€çš„ç»“æœï¼Œè€Œä¸æ˜¯è¯¦ç»†è¯´æ˜å¦‚ä½•è¾¾åˆ°è¿™äº›ç»“æœã€‚é€šè¿‡å£°æ˜å¼çš„æ–¹å¼ï¼Œå¼€å‘äººå‘˜æè¿°ç¨‹åºçš„æœŸæœ›çŠ¶æ€å’Œé€»è¾‘ï¼Œç”±æ¡†æ¶æˆ–è¿è¡Œæ—¶ç¯å¢ƒè´Ÿè´£å¤„ç†å…·ä½“çš„æ‰§è¡Œæµç¨‹ã€‚ å£°åå¼ç¼–ç¨‹æ¡†æ¶çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š ç®€æ´æ€§ï¼šé€šè¿‡å£°æ˜å¼çš„æ–¹å¼ï¼Œå¯ä»¥æ›´æ¸…æ™°ã€ç®€æ´åœ°è¡¨è¾¾ç¨‹åºçš„æ„å›¾å’Œç›®æ ‡ï¼Œå‡å°‘å†—ä½™å’Œé‡å¤çš„ä»£ç ã€‚ å¯è¯»æ€§ï¼šå£°åå¼ä»£ç æ›´æ˜“äºé˜…è¯»å’Œç†è§£ï¼Œå› ä¸ºå®ƒå¼ºè°ƒç¨‹åºçš„ç›®æ ‡å’Œæ„å›¾ï¼Œè€Œä¸æ˜¯è¯¦ç»†çš„æ‰§è¡Œæµç¨‹ã€‚ å¯ç»´æŠ¤æ€§ï¼šå£°åå¼ä»£ç é€šå¸¸æ›´æ˜“äºç»´æŠ¤ï¼Œå› ä¸ºå®ƒå‡å°‘äº†å¤æ‚çš„æ§åˆ¶æµç¨‹å’ŒçŠ¶æ€å˜åŒ–çš„ä»£ç ï¼Œä½¿ä»£ç æ›´æ¨¡å—åŒ–å’Œå¯ç»„åˆã€‚ å¯æ‰©å±•æ€§ï¼šé€šè¿‡å°†ç¨‹åºçš„é€»è¾‘å’Œè¡Œä¸ºä»¥å£°æ˜å¼çš„æ–¹å¼æè¿°ï¼Œå£°åå¼ç¼–ç¨‹æ¡†æ¶æä¾›äº†æ›´çµæ´»å’Œå¯æ‰©å±•çš„æ–¹å¼æ¥ä¿®æ”¹å’Œæ‰©å±•ç¨‹åºã€‚ åœ¨Flutterä¸­ï¼Œå¼€å‘äººå‘˜ä½¿ç”¨å£°æ˜å¼è¯­æ³•æ¥æè¿°æ•°æ®ä¸ç•Œé¢çš„å…³è”å…³ç³»ã€‚é€šè¿‡åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ’å€¼è¡¨è¾¾å¼ã€å±æ€§ä¼ é€’å’Œå›è°ƒå‡½æ•°ï¼Œå¼€å‘äººå‘˜å¯ä»¥å°†æ•°æ®åŠ¨æ€åœ°ç»‘å®šåˆ°ç•Œé¢ä¸Šã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒFlutterä¼šè‡ªåŠ¨é‡æ–°æ„å»ºç›¸å…³çš„ç»„ä»¶ä»¥åæ˜ æœ€æ–°çš„æ•°æ®ã€‚ æ€»ä¹‹ï¼Œå£°åå¼ç¼–ç¨‹æ¡†æ¶æ˜¯ä¸€ç§é€šè¿‡å£°æ˜å¼çš„æ–¹å¼æè¿°ç¨‹åºçš„ç›®æ ‡å’Œç»“æœçš„ç¼–ç¨‹èŒƒå¼ã€‚å®ƒæä¾›äº†ç®€æ´ã€å¯è¯»ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•çš„ä»£ç ç¼–å†™æ–¹å¼ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´èšç„¦äºç¨‹åºçš„é€»è¾‘è€Œä¸æ˜¯å…·ä½“çš„æ§åˆ¶æµç¨‹ã€‚ å£°åå¼æ¡†æ¶ä½¿ç”¨å£°æ˜å¼è¯­æ³•æ¥æè¿°æ•°æ®ä¸ç•Œé¢çš„å…³ç³»ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒFlutterä¼šè‡ªåŠ¨é‡æ–°æ„å»ºç›¸å…³çš„ç»„ä»¶ä»¥åæ˜ æœ€æ–°çš„æ•°æ®ã€‚ Q1 ä»€ä¹ˆæ˜¯çŠ¶æ€ Flutterä¸­çš„çŠ¶æ€æ˜¯æŒ‡åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·è¾“å…¥ã€ç½‘ç»œè¯·æ±‚ç»“æœã€åº”ç”¨ç¨‹åºé…ç½®ç­‰ç­‰ã€‚ æ¯”å¦‚å½“å‰ä½¿ç”¨çš„ä¸»é¢˜ï¼Œè¯­è¨€ Q2 stateå’ŒçŠ¶æ€æ˜¯ä»€ä¹ˆå…³ç³» Flutter åº”ç”¨æ˜¯ å£°æ˜å¼ çš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ Flutter æ„å»ºçš„ç”¨æˆ·ç•Œé¢å°±æ˜¯åº”ç”¨çš„å½“å‰çŠ¶æ€ã€‚ Q3ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç† çŠ¶æ€ç®¡ç†çš„ç›®çš„æ˜¯ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨ä¸åŒç»„ä»¶ä¹‹é—´å…±äº«å’ŒåŒæ­¥çŠ¶æ€çš„å˜åŒ–ã€‚ Q4å¦‚æœæ²¡æœ‰çŠ¶æ€ç®¡ç† å¦‚æœåœ¨Flutteråº”ç”¨ç¨‹åºä¸­ä¸ä½¿ç”¨é€‚å½“çš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®å…±äº«å›°éš¾ã€ç»„ä»¶ä¹‹é—´é€šä¿¡é—®é¢˜ä»¥åŠéš¾ä»¥è¿½è¸ªå’Œç®¡ç†çŠ¶æ€å˜åŒ–ã€‚è¿™äº›é—®é¢˜å¯èƒ½å¯¼è‡´ä»£ç å†—ä½™ã€ç»´æŠ¤å›°éš¾å’Œæ½œåœ¨çš„é”™è¯¯ã€‚å› æ­¤ï¼Œé€‰æ‹©é€‚å½“çš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆå¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä»¥åŠæ”¹å–„åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½“éªŒã€‚ æ¯”å¦‚è´­ç‰©è½¦åŠŸèƒ½ï¼Œå¦‚æœé€šè¿‡ä¸€å±‚ä¸€å±‚çš„å›è°ƒæ–¹æ³•æ¥è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œå°†ä¼šæœ‰æ•°æ®å…±äº«å›°éš¾ã€æ•°æ®æµå˜å¾—æ¨¡ç³Šã€ä»£ç å†—ä½™ç­‰é—®é¢˜ã€‚ Q4çŠ¶æ€ç®¡ç†åŒ… Provider Redux BLoC GetX Q5EvenBus Flutter EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯ä¸€ç§ç”¨äºåœ¨ç»„ä»¶ä¹‹é—´è¿›è¡Œäº‹ä»¶é€šä¿¡çš„æœºåˆ¶ã€‚å®ƒå¯ä»¥ä½œä¸ºä¸€ç§è¾…åŠ©å·¥å…·æ¥å¤„ç†ç»„ä»¶ä¹‹é—´çš„è§£è€¦å’Œé€šä¿¡éœ€æ±‚ï¼Œä½†ä¸å¸¸è§çš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼ˆå¦‚Providerã€GetXã€BLoCç­‰ï¼‰ç›¸æ¯”ï¼Œå®ƒæ›´ä¸“æ³¨äºäº‹ä»¶çš„å‘å¸ƒå’Œè®¢é˜…ã€‚ äº‹ä»¶æ€»çº¿æ¨¡å¼æ˜¯ä¸€ç§å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œé€šè¿‡äº‹ä»¶çš„å‘å¸ƒå’Œè®¢é˜…ï¼Œç»„ä»¶å¯ä»¥åœ¨ä¸ç›´æ¥ä¾èµ–å½¼æ­¤çš„æƒ…å†µä¸‹è¿›è¡Œé€šä¿¡ã€‚é€šè¿‡äº‹ä»¶æ€»çº¿ï¼Œä¸€ä¸ªç»„ä»¶å¯ä»¥å‘é€äº‹ä»¶ï¼Œè€Œå…¶ä»–ç»„ä»¶å¯ä»¥è®¢é˜…å¹¶æ¥æ”¶è¿™äº›äº‹ä»¶ï¼Œå¹¶åšå‡ºç›¸åº”çš„å“åº”ã€‚ åœ¨Flutterä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå®šä¹‰å®ç°çš„äº‹ä»¶æ€»çº¿æ¥å®ç°è¿™ç§é€šä¿¡æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå¸¸è§çš„Flutteräº‹ä»¶æ€»çº¿åº“åŒ…æ‹¬event_buså’Œflutter_blocç­‰ã€‚ å°½ç®¡Flutter EventBuså¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³ç»„ä»¶ä¹‹é—´çš„é€šä¿¡éœ€æ±‚ï¼Œä½†å®ƒå¹¶æ²¡æœ‰æä¾›é›†ä¸­å¼çš„çŠ¶æ€ç®¡ç†å’ŒçŠ¶æ€å˜æ›´çš„æœºåˆ¶ã€‚çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆé€šå¸¸æä¾›ä¸€ç§ç®¡ç†åº”ç”¨ç¨‹åºçŠ¶æ€çš„æœºåˆ¶ï¼Œå¯ä»¥é›†ä¸­å¤„ç†çŠ¶æ€çš„å˜åŒ–ã€è·Ÿè¸ªçŠ¶æ€çš„å˜åŒ–å†å²ï¼Œå¹¶æä¾›ä¸€ç§å“åº”å¼çš„æ–¹å¼æ¥æ›´æ–°ç»„ä»¶çš„UIã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œè™½ç„¶Flutter EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰å¯ä»¥è¾…åŠ©ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ï¼Œä½†å®ƒä¸æ˜¯ä¸¥æ ¼çš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸“é—¨çš„çŠ¶æ€ç®¡ç†åº“å¯ä»¥æ›´å¥½åœ°ç®¡ç†å’Œå“åº”åº”ç”¨ç¨‹åºçš„çŠ¶æ€å˜åŒ–ã€‚ çŠ¶æ€ (State) ç®¡ç†ä»‹ç» "},"flutter/çŠ¶æ€ç®¡ç†/01Provider/01InheritedWidget.html":{"url":"flutter/çŠ¶æ€ç®¡ç†/01Provider/01InheritedWidget.html","title":"01InheritedWidget","keywords":"","body":"1. InheritedWidgetçš„ä½¿ç”¨ é¦–å…ˆåˆ›å»ºä¸€ä¸ªShareDataWidgetç»§æ‰¿è‡ªInheritedWidget class ShareDataWidget extends InheritedWidget { const ShareDataWidget({ Key? key, required this.data, required Widget child, }) : super(key: key, child: child); final int data; //éœ€è¦åœ¨å­æ ‘ä¸­å…±äº«çš„æ•°æ®ï¼Œä¿å­˜ç‚¹å‡»æ¬¡æ•° //å®šä¹‰ä¸€ä¸ªä¾¿æ·æ–¹æ³•ï¼Œæ–¹ä¾¿å­æ ‘ä¸­çš„widgetè·å–å…±äº«æ•°æ® static ShareDataWidget? of(BuildContext context) { //return context.dependOnInheritedWidgetOfExactType(); return context .getElementForInheritedWidgetOfExactType() ?.widget as ShareDataWidget; } //è¯¥å›è°ƒå†³å®šå½“dataå‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ˜¯å¦é€šçŸ¥å­æ ‘ä¸­ä¾èµ–dataçš„Widget @override bool updateShouldNotify(ShareDataWidget old) { return old.data != data; } } å®ç°ä¸€ä¸ªå­ç»„ä»¶_TestWidgetï¼Œåœ¨å…¶buildæ–¹æ³•ä¸­å¼•ç”¨ShareDataWidgetä¸­çš„æ•°æ®ã€‚åŒæ—¶ï¼Œåœ¨å…¶didChangeDependencies() å›è°ƒä¸­æ‰“å°æ—¥å¿— class _TestWidget extends StatefulWidget { @override __TestWidgetState createState() => __TestWidgetState(); } class __TestWidgetState extends State { @override Widget build(BuildContext context) { //ä½¿ç”¨InheritedWidgetä¸­çš„å…±äº«æ•°æ® //stylebegin {background-color: #FFFF0050;} return Text(ShareDataWidget.of(context)!.data.toString()); //styleend } @override void didChangeDependencies() { super.didChangeDependencies(); //çˆ¶æˆ–ç¥–å…ˆwidgetä¸­çš„InheritedWidgetæ”¹å˜(updateShouldNotifyè¿”å›true)æ—¶ä¼šè¢«è°ƒç”¨ã€‚ //å¦‚æœbuildä¸­æ²¡æœ‰ä¾èµ–InheritedWidgetï¼Œåˆ™æ­¤å›è°ƒä¸ä¼šè¢«è°ƒç”¨ã€‚ print(\"Dependencies change\"); } } InheritedWidgetTestRouteåˆ›å»ºä¸€ä¸ªæŒ‰é’®ï¼Œæ¯ç‚¹å‡»ä¸€æ¬¡ï¼Œå°±å°†ShareDataWidgetçš„å€¼è‡ªå¢ class InheritedWidgetTestRoute extends StatefulWidget { ... } class _InheritedWidgetTestRouteState extends State { int count = 0; @override Widget build(BuildContext context) { return Center( //stylebegin {background-color: #FFFF0050;} child: ShareDataWidget( //ä½¿ç”¨ShareDataWidget //styleend data: count, child: Column( mainAxisAlignment: MainAxisAlignment.center, children: [ Padding( padding: const EdgeInsets.only(bottom: 20.0), child: _TestWidget(), //å­widgetä¸­ä¾èµ–ShareDataWidget ), ElevatedButton( child: const Text(\"Increment\"), //æ¯ç‚¹å‡»ä¸€æ¬¡ï¼Œå°†countè‡ªå¢ï¼Œç„¶åé‡æ–°build,ShareDataWidgetçš„dataå°†è¢«æ›´æ–° onPressed: () => setState(() => ++count), ) ], ), ), ); } } 2. InheritedWidgetçš„åŸç† 2.1 _inheritedWidgets abstract class Element extends DiagnosticableTree implements BuildContext Element? _parent; PersistentHashMap? _inheritedWidgets; Set? _dependencies; bool _hadUnsatisfiedDependencies = false; /// Add this element to the tree in the given slot of the given parent. @mustCallSuper void mount(Element? parent, Object? newSlot) { ... _updateInheritance(); ... } /// Transition from the \"inactive\" to the \"active\" lifecycle state. @mustCallSuper void activate() { ... _updateInheritance(); ... } void _updateInheritance() { ... _inheritedWidgets = _parent?._inheritedWidgets; } } class InheritedElement extends ProxyElement{ final Map _dependents = HashMap(); @override void _updateInheritance() { final PersistentHashMap incomingWidgets = _parent?._inheritedWidgets ?? const PersistentHashMap.empty(); _inheritedWidgets = incomingWidgets.put(widget.runtimeType, this); } } _inheritedWidgets void _updateInheritance()ä¸»è¦è´Ÿè´£ _inheritedWidgetsèµ‹å€¼ è°ƒç”¨æ—¶æœº: mountå’Œactivateæ–¹æ³•ã€‚ å¯¹äºæ™®é€šçš„Elementï¼Œ_inheritedWidgetsåªæ˜¯ä»_parentè¯»å–ã€‚ InheritedElementä¸­ï¼Œ_inheritedWidgetsä»_parentè¯»å–ä¸ºç©ºçš„è¯ï¼Œä¼šåˆ›å»ºä¸€ä¸ªã€‚å¹¶å­˜å‚¨ã€‚keyä¸ºwidget.runtimeType,valueä¸ºå½“å‰çš„InheritedElementã€‚ _inheritedWidgets æ–¹ä¾¿è§‚å¯Ÿè€…å¿«é€Ÿè·å–åˆ°å¯¹åº”çš„InheritedElementï¼Œä»è€Œè·å–æ•°æ®ã€‚ _dependents InheritedElementä¸­çš„_dependentsï¼Œå­˜å‚¨äº†è§‚å¯Ÿè€… éœ€è¦æ›´æ–°æ—¶ï¼Œéå†è§‚å¯Ÿè€…ï¼Œé€šçŸ¥è§‚å¯Ÿè€…æ›´æ–° _dependencies Set? _dependencies;è§‚å¯Ÿè€…å­˜å‚¨äº†ä»–æ‰€ä¾èµ–çš„ InheritedElementã€‚ class _UbiquitousInheritedElement extends InheritedElementä¸­æœ‰ç”¨åˆ°ã€‚ å»æ‰äº†ï¼Œ_dependentsã€‚è¿™æ ·ä¿è¯åˆ›å»ºè¿‡ç¨‹æ›´å¿«é€Ÿã€‚ä½†æ˜¯æ›´æ–°ä¼šå˜æ…¢ã€‚ å¯ä»¥çœ‹è¿™é‡Œ 2.2 æ³¨å†Œä¾èµ–å…³ç³» T? dependOnInheritedWidgetOfExactType({ Object? aspect }); abstract class Element extends DiagnosticableTree implements BuildContext @override T? dependOnInheritedWidgetOfExactType({Object? aspect}) { assert(_debugCheckStateIsActiveForAncestorLookup()); // 1. æŸ¥æ‰¾InheritedElementç±»å‹çš„ç¥–å…ˆèŠ‚ç‚¹ final InheritedElement? ancestor = _inheritedWidgets == null ? null : _inheritedWidgets![T]; if (ancestor != null) { return dependOnInheritedElement(ancestor, aspect: aspect) as T; } _hadUnsatisfiedDependencies = true; return null; } @override InheritedWidget dependOnInheritedElement(InheritedElement ancestor, { Object? aspect }) { // 2. åˆ›å»º_dependenciesç”¨æ¥å­˜å‚¨å½“å‰elementä¾èµ–äº†å“ªäº›InheritedElement _dependencies ??= HashSet(); _dependencies!.add(ancestor); // ancestor.updateDependencies(this, aspect); //æ·»åŠ åˆ°InheritedElementä¸­ã€‚ // 4. è¿”å› ancestorï¼ˆInheritedWidgetç±»å‹çš„ç¥–å…ˆèŠ‚ç‚¹ï¼‰ return ancestor.widget as InheritedWidget; } } class InheritedElement extends ProxyElement{ final Map _dependents = HashMap(); @protected void updateDependencies(Element dependent, Object? aspect) { setDependencies(dependent, null); } @protected void setDependencies(Element dependent, Object? value) { // 3. InheritedElementä¸­çš„_dependentsï¼Œç”¨æ¥å­˜å‚¨å¯¹åº”çš„è§‚å¯Ÿè€…ã€‚ _dependents[dependent] = value; //æ·»åŠ åˆ°å¯¹åº”çš„mapç§ã€‚ è¿™é‡Œvalueä¸ºç©ºã€‚ } } ä¾èµ–å…³ç³»ï¼š Elementï¼ˆè§‚å¯Ÿè€…ï¼‰ä¸­çš„_dependencieså­˜å‚¨äº†ä½¿ç”¨åˆ°çš„InheritedElement InheritedElementçš„_dependentså­˜å‚¨äº†æ³¨å†Œçš„è§‚å¯Ÿè€…Element 2.3 æ›´æ–°ç›‘å¬ class InheritedElement extends ProxyElement{ //é‡å†™äº†updatedæ–¹æ³• @override void updated(InheritedWidget oldWidget) { if ((widget as InheritedWidget).updateShouldNotify(oldWidget)) { super.updated(oldWidget); // superä¸­è°ƒç”¨äº†notifyClients } } //éå†æ¯ä¸€ä¸ªç›‘å¬è€… @override void notifyClients(InheritedWidget oldWidget) { for (final Element dependent in _dependents.keys) { notifyDependent(oldWidget, dependent); } } //è°ƒç”¨åšæŒºç€didChangeDependenciesæ–¹æ³• @protected void notifyDependent(covariant InheritedWidget oldWidget, Element dependent) { dependent.didChangeDependencies(); } } abstract class Element extends DiagnosticableTree implements BuildContext { //æ ‡è®°ä¸º_dirty @mustCallSuper void didChangeDependencies() { markNeedsBuild(); } void markNeedsBuild() { if (dirty) { return; } _dirty = true; owner!.scheduleBuildFor(this); } } class BuildOwner { void scheduleBuildFor(Element element) { _dirtyElements.add(element); //æ·»åŠ åˆ°dirtyElementsåˆ—è¡¨ä¸­ã€‚ element._inDirtyList = true; } } 3.æ€»ç»“ _inheritedWidgetså­˜å‚¨InheritedElementï¼Œæ–¹ä¾¿è§‚å¯Ÿè€…å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„InheritedElement _dependents å­˜å‚¨è§‚å¯Ÿè€…ï¼ŒInheritedElementé€šè¿‡éå†é€šçŸ¥è§‚å¯Ÿè€…æ›´æ–° æœ¬èº«æ‰€æœ‰çš„Elementéƒ½ç»´æŠ¤ä¸€ä¸ªmapã€‚ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå…¨å±€çš„ï¼Œå› ä¸ºä¼šå…ˆä»_parentè·å–ï¼‰ PersistentHashMap? _inheritedWidgets; elementç±»å‹ä¸ºkeyã€‚ æ¯ä¸€ä¸ªInheritedElementå®ä¾‹å¯¹è±¡éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªmapã€‚ final Map _dependents = HashMap(); ä»¥è°ƒç”¨è€…çš„elementä¸ºkeyï¼Œvalueå¯ä»¥ä¸ºç©ºã€‚ å½“åˆ›å»ºä¸€ä¸ªInheritedElementï¼Œè°ƒç”¨mountæ—¶å°±ä¼šåŠ å…¥åˆ°_inheritedWidgetsä¸­ã€‚ æŸ¥æ‰¾çš„æ—¶å€™é€šè¿‡ç±»å‹ç›´æ¥åœ¨mapä¸­æ‰¾å‡ºã€‚ è°ƒç”¨dependOnInheritedWidgetOfExactTypeè·å–å€¼çš„æ—¶å€™ _inheritedWidgetsä¸­æ‰¾åˆ°å¯¹åº”çš„InheritedElement å°†å½“å‰å¯¹è±¡å­˜å‚¨åˆ°InheritedElementå¯¹åº”çš„_dependentså­—å…¸ä¸­ è¿”å›å¯¹åº”çš„InheritedElement éœ€è¦æ›´æ–°ï¼Œè°ƒç”¨InheritedWidgetçš„updateçš„æ—¶å€™ _dependents.keysè·å–å­˜å‚¨çš„elementï¼Œå¹¶è°ƒç”¨å…¶didChangeDependenciesæ–¹æ³•ã€‚ didChangeDependencies --> markNeedsBuild --> _dirty = true; 4. åº”è¯¥åœ¨didChangeDependencies()ä¸­åšä»€ä¹ˆï¼Ÿ ä¸€èˆ¬æ¥è¯´ï¼Œå­ widget å¾ˆå°‘ä¼šé‡å†™æ­¤æ–¹æ³•ï¼Œå› ä¸ºåœ¨ä¾èµ–æ”¹å˜å Flutter æ¡†æ¶ä¹Ÿéƒ½ä¼šè°ƒç”¨build()æ–¹æ³•é‡æ–°æ„å»ºç»„ä»¶æ ‘ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦åœ¨ä¾èµ–æ”¹å˜åæ‰§è¡Œä¸€äº›æ˜‚è´µçš„æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¿™æ—¶æœ€å¥½çš„æ–¹å¼å°±æ˜¯åœ¨æ­¤æ–¹æ³•ä¸­æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡build()éƒ½æ‰§è¡Œè¿™äº›æ˜‚è´µæ“ä½œã€‚ 5. å…¶ä»– _UbiquitousInheritedElement /// An [InheritedElement] that has hundreds of dependencies but will /// infrequently change. This provides a performance tradeoff where building /// the [Widget]s is faster but performing updates is slower. /// /// | | _UbiquitousInheritedElement | InheritedElement | /// |---------------------|------------------------------|------------------| /// | insert (best case) | O(1) | O(1) | /// | insert (worst case) | O(1) | O(n) | /// | search (best case) | O(n) | O(1) | /// | search (worst case) | O(n) | O(n) | /// /// Insert happens when building the [Widget] tree, search happens when updating /// [Widget]s. class _UbiquitousInheritedElement extends InheritedElement { /// Creates an element that uses the given widget as its configuration. _UbiquitousInheritedElement(super.widget); @override void setDependencies(Element dependent, Object? value) { // This is where the cost of [InheritedElement] is incurred during build // time of the widget tree. Omitting this bookkeeping is where the // performance savings come from. assert(value == null); } @override Object? getDependencies(Element dependent) { return null; } @override void notifyClients(InheritedWidget oldWidget) { _recurseChildren(this, (Element element) { if (element.doesDependOnInheritedElement(this)) { notifyDependent(oldWidget, element); } }); } static void _recurseChildren(Element element, ElementVisitor visitor) { element.visitChildren((Element child) { _recurseChildren(child, visitor); }); visitor(element); } } å‚è€ƒ ã€è€å­ŸFlutterã€‘æºç åˆ†æç³»åˆ—ä¹‹InheritedWidget ä¸€æ–‡ææ‡‚InheritedWidgetå±€éƒ¨åˆ·æ–°æœºåˆ¶ flutteré˜²æ­¢widget rebuildç»ˆæè§£å†³åŠæ³• "},"flutter/çŠ¶æ€ç®¡ç†/01Provider/02ProvideråŸºæœ¬ä½¿ç”¨.html":{"url":"flutter/çŠ¶æ€ç®¡ç†/01Provider/02ProvideråŸºæœ¬ä½¿ç”¨.html","title":"02ProvideråŸºæœ¬ä½¿ç”¨","keywords":"","body":"Providerä¼˜åŠ¿ æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨Providerè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨InheritedWidgetï¼Œæˆ‘ä»¬çœ‹ä¸‹å®˜æ–¹ä»‹ç» ç®€åŒ–çš„èµ„æºåˆ†é…ä¸å¤„ç½® æ‡’åŠ è½½ åˆ›å»ºæ–°ç±»æ—¶å‡å°‘å¤§é‡çš„æ¨¡æ¿ä»£ç  æ”¯æŒ DevTools æ›´é€šç”¨çš„è°ƒç”¨ InheritedWidget çš„æ–¹å¼ï¼ˆå‚è€ƒ Provider.of/Consumer/Selectorï¼‰ æå‡ç±»çš„å¯æ‰©å±•æ€§ï¼Œæ•´ä½“çš„ç›‘å¬æ¶æ„æ—¶é—´å¤æ‚åº¦ä»¥æŒ‡æ•°çº§å¢é•¿ï¼ˆå¦‚ ChangeNotifierï¼Œ å…¶å¤æ‚åº¦ä¸º O(N)ï¼‰ å¸¸è§çš„å‡ ç§Provider Provider Provideræ˜¯æœ€åŸºæœ¬çš„Providerç»„ä»¶ // This class is what Provider will work with. // It will _provide_ an instance of the class to any widget // in the tree that cares about it. class Person { Person({this.name, this.age}); final String name; final int age; } // Here, we are running an app as you'd expect with any Flutter app // But, we're also wrapping `MyApp` in a widget called 'Provider' // Importantly, `Provider` is itself a widget, so it can live in the widget tree. // This class uses a property called `create` to make an instance of `Person` // whenever it's needed by a widget in the tree. // The object returned by the function passed to `create` is what the rest of our app // has access to. void main() { runApp( Provider( create: (_) => Person(name: \"Yohan\", age: 25), child: MyApp(), ), ); } // Just a plain ol' StatelessWidget class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return const MaterialApp( home: MyHomePage(), ); } } // Again, just a stateless widget class MyHomePage extends StatelessWidget { const MyHomePage({Key key}) : super(key: key); @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text('Provider Class'), ), body: Center( child: Text( // this string is where we use Provider to fetch the instance // of `Person` created above in the `create` property ''' Hi ${Provider.of(context).name}! You are ${Provider.of(context).age} years old''', ), ), ); } } ListenableProvider ChangeNotifierProviderç»§æ‰¿è‡ªListenableProviderä¸”å¯¹åº”çš„ChangeNotifierç»§æ‰¿è‡ªlistenableï¼›ç®—æ˜¯ListenableProviderçš„å­ç±»ï¼›ValueNotifierç»§æ‰¿è‡ªChangeNotifierä¹Ÿä¸ChangeNotifierProviderç›¸ä¼¼ï¼› ä½¿ç”¨ChangeNotifierProviderå’ŒValueListenableProviderç»‘å®šå®ä½“ç±»æ—¶éœ€è¦æ³¨æ„åˆ†åˆ«ç»§æ‰¿å¯¹åº”çš„ChangeNotifierå’ŒValueNotifierï¼› æ‰€ä»¥ChangeNotifierProvideråªæ˜¯å¯¹ListenableProviderçš„è¿›ä¸€æ­¥å°è£…ã€‚ä»ValueNotifieråˆ°ChangeNotifierçš„ç›‘å¬ã€‚ ChangeNotifierProvider å®ƒè·ŸProviderç»„ä»¶ä¸åŒï¼ŒChangeNotifierProviderä¼šç›‘å¬æ¨¡å‹å¯¹è±¡çš„å˜åŒ–ï¼Œè€Œä¸”å½“æ•°æ®æ”¹å˜æ—¶ï¼Œå®ƒä¹Ÿä¼šé‡å»ºConsumerï¼ˆæ¶ˆè´¹è€…ï¼‰ class Person with ChangeNotifier { Person({this.name, this.age}); final String name; int age; void increaseAge() { this.age++; notifyListeners(); } } // here, you can see that the [ChangeNotifierProvider] // is \"wired up\" exactly like the vanilla [Provider] void main() { runApp( ChangeNotifierProvider( create: (_) => Person(name: \"Yohan\", age: 25), child: MyApp(), ), ); } class MyHomePage extends StatelessWidget { const MyHomePage({Key key}) : super(key: key); @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text('Provider Class'), ), body: Center( child: Text( // reading this data is exactly like it was in // the previous lesson ''' Hi ${Provider.of(context).name;}! You are ${Provider.of(context).age} years old''', ), ), floatingActionButton: FloatingActionButton( // this is where there's a difference. // when the FAB is tapped, it will call `Person.icreaseAge()` on the // person instance that was created by provider. onPressed: () => Provider.of(context, listen: false).increaseAge(), ), ); } } ValueListenableProvider FutureProvider ç”¨äºæä¾›åœ¨ç»„ä»¶æ ‘ä¸­å‡†å¤‡å¥½ä½¿ç”¨å…¶å€¼æ—¶å¯èƒ½å°šæœªå‡†å¤‡å¥½çš„å€¼ï¼Œä¸»è¦æ˜¯ç¡®ä¿ç©ºå€¼ä¸ä¼šä¼ é€’ç»™ä»»ä½•å­ç»„ä»¶ï¼Œè€Œä¸”FutureProvideræœ‰ä¸€ä¸ªåˆå§‹å€¼ï¼Œå­ç»„ä»¶å¯ä»¥ä½¿ç”¨è¯¥Futureå€¼å¹¶å‘Šè¯‰å­ç»„ä»¶ä½¿ç”¨æ–°çš„å€¼æ¥è¿›è¡Œé‡å»ºã€‚ class Person { Person({this.name, this.age}); final String name; int age; } class Home { final String city = \"Portland\"; Future get fetchAddress { final address = Future.delayed(Duration(seconds: 2), () { return '1234 North Commercial Ave.'; }); return address; } } void main() { runApp( Provider( create: (_) => Person(name: 'Yohan', age: 25), child: FutureProvider( create: (context) => Home().fetchAddress, initialData: \"fetching address...\", child: MyApp(), ), ), ); } class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return const MaterialApp( home: MyHomePage(), ); } } class MyHomePage extends StatelessWidget { const MyHomePage({Key key}) : super(key: key); @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: Text(\"Future Provider\"), ), body: Padding( padding: const EdgeInsets.all(8.0), child: Center( child: Consumer( builder: (context, Person person, child) { return Column( children: [ Text(\"User profile:\"), Text(\"name: ${person.name}\"), Text(\"age: ${person.age}\"), Consumer(builder: (context, String address, child) { return Text(\"address: $address\"); }), ], ); }, ), ), ), ); } } æ³¨æ„ï¼š FutureProvideråªä¼šé‡å»ºä¸€æ¬¡ é»˜è®¤æ˜¾ç¤ºåˆå§‹å€¼ ç„¶åæ˜¾ç¤ºFutureå€¼ æœ€åä¸ä¼šå†æ¬¡é‡å»º StreamProvider StreamProvideræä¾›æµå€¼ï¼Œæ˜¯å›´ç»•StreamBuilderï¼Œæ‰€æä¾›çš„å€¼ä¼šåœ¨ä¼ å…¥çš„æ—¶å€™æ›¿æ¢æ‰æ–°å€¼ã€‚å’ŒFutureProviderä¸€æ ·ï¼Œä¸»è¦çš„åŒºåˆ«åœ¨äºå€¼ä¼šæ ¹æ®å¤šæ¬¡è§¦å‘é‡æ–°æ„å»ºUIã€‚ class Person { Person({this.name, this.initialAge}); final String name; final int initialAge; Stream get age async* { var i = initialAge; while (i ( create: (_) => Person(name: 'Yohan', initialAge: 25).age, initialData: 25.toString(), catchError: (_, error) => error.toString(), child: MyApp(), ), ); } class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return const MaterialApp( home: MyHomePage(), ); } } class MyHomePage extends StatelessWidget { const MyHomePage({Key key}) : super(key: key); @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: Text(\"Future Provider\"), ), body: Padding( padding: const EdgeInsets.all(8.0), child: Center( child: Consumer( builder: (context, String age, child) { return Column( children: [ Text(\"Watch Yohan Age...\"), Text(\"name: Yohan\"), Text(\"age: $age\"), ], ); }, ), ), ), ); } } ProxyProvider ProxyProvidersæœ‰å‡ ç§ ProxyProvider ChangeNotifierProxyProvider ListenableProxyProvider å½“æˆ‘ä»¬æœ‰å¤šä¸ªæ¨¡å‹çš„æ—¶å€™ï¼Œä¼šæœ‰æ¨¡å‹ä¾èµ–å¦ä¸€ä¸ªæ¨¡å‹çš„æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ProxyProviderä»å¦ä¸€ä¸ªæä¾›è€…è·å–å€¼ï¼Œç„¶åå°†å…¶æ³¨å…¥åˆ°å¦ä¸€ä¸ªæä¾›è€…ä¸­ã€‚ testWidgets('ListenableProxyProvider2', (tester) async { await tester.pumpWidget( MultiProvider( providers: [ Provider.value(value: a), Provider.value(value: b), Provider.value(value: c), Provider.value(value: d), Provider.value(value: e), Provider.value(value: f), ProxyProvider2( create: (_) => const Combined(), update: (context, a, b, previous) => Combined(context, previous, a, b), ) ], child: mockConsumer, ), ); å½“a,bæœ‰å˜åŒ–æ—¶ï¼Œéƒ½ä¼šé€šçŸ¥åˆ°ListenableProxyProvider2ã€‚ ChangeNotifierProxyProvider å’ŒProxyProvideråŸç†ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå®ƒæ„å»ºå’ŒåŒæ­¥ChangeNotifierçš„ChangeNotifierProviderï¼Œå½“æä¾›è€…æ•°æ®å˜åŒ–æ—¶ï¼Œå°†ä¼šé‡æ„UIã€‚ import 'dart:collection'; import 'package:flutter/foundation.dart'; import 'package:flutter/material.dart'; class Person with ChangeNotifier { Person({this.name, this.age}); final String name; int age; void increaseAge() { this.age++; notifyListeners(); } } class Job with ChangeNotifier { Job( this.person, { this.career, }); final Person person; String career; String get title { if (person.age >= 28) return 'Dr. ${person.name}, $career PhD'; return '${person.name}, Student'; } } void main() { runApp( MultiProvider( providers: [ ChangeNotifierProvider(create: (_) => Person(name: 'Yohan', age: 25)), ChangeNotifierProxyProvider( //å½“personå˜åŒ–ï¼Œä¹Ÿä¼šé€šçŸ¥åˆ°Jobã€‚ create: (BuildContext context) => Job(Provider.of(context, listen: false)), update: (BuildContext context, Person person, Job job) => Job(person, career: 'Vet'), ), ], child: MyApp(), ), ); } class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return const MaterialApp( home: MyHomePage(), ); } } class MyHomePage extends StatelessWidget { const MyHomePage({Key key}) : super(key: key); @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text('Provider Class'), ), body: Align( alignment: Alignment.center, child: Container( padding: EdgeInsets.all(20.0), decoration: BoxDecoration( border: Border.all(), borderRadius: BorderRadius.circular(5.0), ), child: Column( mainAxisSize: MainAxisSize.min, children: [ Text( 'Hi, may name is ${context.select((Job j) => j.person.name)}', style: Theme.of(context).textTheme.headline6, ), Text('Age: ${context.select((Job j) => j.person.age)}'), Text(context.watch().title), ], ), ), ), floatingActionButton: FloatingActionButton( onPressed: () => Provider.of(context, listen: false).increaseAge(), ), ); } } ListenableProxyProvider ListenableProxyProvideræ˜¯ListenableProviderçš„ä¸€ä¸ªå˜ä½“ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šå’ŒChangeNotifierProvideræ•ˆæœæƒŠäººçš„ä¸€è‡´ MultiProvider ç»§æ‰¿è‡ªNested class MultiProvider extends Nested { MultiProvider({ Key? key, required List providers, Widget? child, TransitionBuilder? builder, }) : super( key: key, children: providers, child: builder != null ? Builder( builder: (context) => builder(context, child), ) : child, ); } test(){ MultiProvider( providers: [ PA, PB, PC ), child: XXX(), } PAçš„childæ˜¯PBã€‚PBçš„childæ˜¯PCã€‚PCçš„childæ˜¯XXXã€‚ .value constructors ä¹‹å‰ä½¿ç”¨Provideræ—¶å€™ï¼Œéƒ½æ˜¯ä½¿ç”¨create()è¿›è¡Œåˆ›å»ºä¸€ä¸ªæ–°å€¼ï¼Œå€˜è‹¥æˆ‘ä»¬æƒ³è¦è§‚æµ‹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å®ä¾‹åŒ–å¯¹è±¡æ—¶å€™ï¼Œå°±ä¸å¯ä»¥è¿™æ ·äº†ã€‚ è¿™æ—¶å€™éœ€è¦ä½¿ç”¨Provider.valueçš„æ–¹å¼æˆ–è€…å…¶å®ƒç±»çš„.value,ä¾‹å¦‚ChangeNotifierProvider.value è¯¥æ–¹æ³•ä¹Ÿå¯ä»¥å°†å†…éƒ¨çš„æŸä¸ªå€¼æä¾›ç»™å…¶å­ç±» æ€»ç»“ï¼šåœ¨ Provider ä¸­ï¼Œ.value æ–¹æ³•ç”¨äºæ‰‹åŠ¨æä¾›ä¸€ä¸ªå›ºå®šçš„æ•°å€¼ä½œä¸ºæ•°æ®æºï¼Œè€Œä¸ä½¿ç”¨ Provider ç±»è‡ªåŠ¨åˆ›å»ºæˆ–ç®¡ç†æ•°æ®æºã€‚ æ€»ç»“ Providerä¸ºæˆ‘ä»¬æä¾›äº†éå¸¸å¤šçš„æä¾›è€…ã€‚ä½†æˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ChangeNotifierProviderã€MultiProviderã€ChangeNotifierProxyProviderï¼Œå…³äºå…¶ä»–çš„æä¾›è€…å¯æ ¹æ®è‡ªå·±çš„å®é™…åº”ç”¨åœºæ™¯æ¥ã€‚ å››ç§æ¶ˆè´¹è€… Provider.of Provider.of(context).increment(); static T of(BuildContext context, {bool listen = true}) { assert( context.owner!.debugBuilding || //widgetæ­£åœ¨æ„å»º listen == false || //widgetå¦‚æœä¸æ˜¯æ„å»ºè¿‡ç¨‹ï¼Œè¯´æ˜æ˜¯ç±»ä¼¼ç‚¹å‡»æŒ‰é’®å–å€¼ï¼Œä¸ç”¨listenã€‚ debugIsInInheritedProviderUpdate, ''' Tried to listen to a value exposed with provider, from outside of the widget tree. This is likely caused by an event handler (like a button's onPressed) that called Provider.of without passing `listen: false`. To fix, write: Provider.of(context, listen: false); It is unsupported because may pointlessly rebuild the widget associated to the event handler, when the widget tree doesn't care about the value. The context used was: $context ''', ); ... child: ElevatedButton( onPressed: (){ Provider.of(context).increment(); //æŠ¥é”™ Provider.of(context, listen: false).increment(); }, child: Text(\"ç‚¹å‡»åŠ 1\"), ), Consumer Consumberåªæ˜¯åœ¨Widgetä¸­è°ƒç”¨äº†Prvoider.ofï¼Œå¹¶å°†å…¶æ„é€ å®ç°å§”æ‰˜ç»™äº†æ„é€ å™¨ class Consumer extends SingleChildStatelessWidget { Consumer({ Key? key, required this.builder, Widget? child, }) : super(key: key, child: child); final Widget Function( BuildContext context, T value, Widget? child, ) builder; //æ•°æ®æ›´æ–°çš„æ—¶å€™ä¼šè°ƒç”¨buildWithChildã€‚ childä¿å­˜åœ¨Consumerå±æ€§ä¸­ã€‚ä¸ä¼šæ›´æ–°ã€‚ @override Widget buildWithChild(BuildContext context, Widget? child) { return builder( context, Provider.of(context), child, ); } } Selector é€‰æ‹©å™¨ä¸æ¶ˆè´¹è€…ç›¸ä¼¼ï¼Œä½†å¯¹ä½•æ—¶è°ƒç”¨å°éƒ¨ä»¶buildæ–¹æ³•æä¾›äº†ä¸€äº›ç²¾ç»†çš„æ§åˆ¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œselectoræ˜¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå®ƒå…è®¸æ‚¨ä»æ‚¨å…³å¿ƒçš„æ¨¡å‹ä¸­å‡†ç¡®å®šä¹‰å“ªäº›å±æ€§ã€‚ class Person with ChangeNotifier { Person({this.name, this.age}); final String name; int age; void increaseAge() { this.age++; notifyListeners(); } } void main() { runApp( ChangeNotifierProvider( create: (_) => Person(name: \"Yohan\", age: 25), child: MyApp(), ), ); } class MyHomePage extends StatelessWidget { const MyHomePage({Key key}) : super(key: key); @override Widget build(BuildContext context) { return Selector( selector: (BuildContext context, Person person) => person.name, builder: (context, String name, child) { return Scaffold( appBar: AppBar( title: Text(\"${name} -- ${Provider.of(context).age} yrs old\"), ), body: child, ); }, child: Center( child: Text('Hi this represents a huge widget! Like a scrollview with 500 children!'), ), ); } } Context Extension InheritedContextæ˜¯Providerå†…ç½®æ‰©å±•äº†BuildContextï¼Œå®ƒä¸ä¿å­˜äº†ç»„ä»¶åœ¨æ ‘ä¸­è‡ªå·±ä½ç½®çš„å¼•ç”¨ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­è§åˆ°Provider.of(contextï¼Œlisten: false)ï¼Œå…¶å®è¿™ä¸ªofæ–¹æ³•å°±æ˜¯ä½¿ç”¨FlutteræŸ¥æ‰¾æ ‘å¹¶æ‰¾åˆ°Providerå­ç±»å‹ä¸ºCountNotifier1è€Œå·²ã€‚ BuildContext.read: BuildContext.read()å¯ä»¥æ›¿æ¢æ‰Provider.of(contextï¼Œlisten: false)ï¼Œå®ƒä¼šæ‰¾åˆ°CountNotifier1å¹¶è¿”å›å®ƒã€‚ BuildContext.watch: BuildContext.watch()å¯ä»¥æ›¿æ¢æ‰Provider.of(contextï¼Œlisten: false)ï¼Œçœ‹èµ·æ¥å’Œreadæ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œä½†æ˜¯ä½¿ç”¨watchä½ å°±ä¸éœ€è¦åœ¨ä½¿ç”¨Consumerã€‚ BuildContext.select: BuildContext.select()å¯ä»¥æ›¿æ¢æ‰Provider.of(contextï¼Œlisten: false)ï¼Œçœ‹èµ·æ¥å’Œwatchä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œä½†æ˜¯ä½¿ç”¨selectä½ å°±ä¸éœ€è¦åœ¨ä½¿ç”¨Selectorã€‚ layz lazyä¸ºtrue createåœ¨è·å–å€¼çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ é˜²æ­¢é‡å¤åˆ·æ–° å‚è€ƒ README proxy-provider flutter_by_example_static ä½¿ç”¨ Nested å¤„ç† flutter åµŒå¥—è¿‡æ·± "},"flutter/çŠ¶æ€ç®¡ç†/01Provider/03Provideræºç è§£æ.html":{"url":"flutter/çŠ¶æ€ç®¡ç†/01Provider/03Provideræºç è§£æ.html","title":"03Provideræºç è§£æ","keywords":"","body":"Provider ä»æœ€åŸºç¡€çš„InheritedProviderå¼€å§‹åˆ†æã€‚äº†è§£äº†è¿™ä¸€éƒ¨åˆ†ï¼Œå…¶ä»–çš„åªæ˜¯å†èµ·åŸºç¡€ä¸Šè¿›è¡Œäº†å†…å®¹ä¸°å¯Œã€‚ 1. InheritedProvider 1.1 class InheritedProvider ç²¾ç®€ä»£ç ä¹‹åå¦‚ä¸‹ã€‚é‡ç‚¹æ³¨é‡Šå¯ä»¥æŸ¥çœ‹ä»£ç ã€‚ class InheritedProvider extends SingleChildStatelessWidget { // 1. æ„é€ æ–¹æ³• InheritedProvider({ Key? key, Create? create, // ç”¨æ¥åˆ›å»ºProvideræŒæœ‰çš„å¯¹è±¡ T Function(BuildContext context, T? value)? update, // å½“å‰Provideræ›´æ–°æ—¶è§¦å‘ã€‚ // Provideræ›´æ–°æ—¶,æ•°æ®ä¸ä¸€å®šå˜åŒ–ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦é€šçŸ¥è§‚å¯Ÿè€…æ›´æ–°ã€‚ UpdateShouldNotify? updateShouldNotify, // ç¬¬ä¸€æ¬¡è·å–æ•°æ®çš„æ—¶å€™è¢«è°ƒç”¨ã€‚è¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„ç›‘å¬ StartListening? startListening, Dispose? dispose, //ä»widget treeä¸­ç§»é™¤çš„æ—¶å€™è°ƒç”¨ this.builder, //æ„é€ è¯­æ³•ç³– bool? lazy, // createæ–¹æ³•æ˜¯å¦æ‡’åŠ è½½ Widget? child, }) : _lazy = lazy, //å°†ä¸Šé¢çš„åˆå§‹åŒ–å‚æ•°ä¼ é€’ç»™ä»£ç†ã€‚è¿™æ ·å¯ä»¥é€šè¿‡å®ç°ä¸åŒçš„ä»£ç†å¯¹è±¡å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚ _delegate = _CreateInheritedProvider( create: create, update: update, updateShouldNotify: updateShouldNotify, startListening: startListening, dispose: dispose, ), super(key: key, child: child); final _Delegate _delegate; final bool? _lazy; final TransitionBuilder? builder; @override Widget buildWithChild(BuildContext context, Widget? child) { //æ ¹å¸ƒå±€æ˜¯ _InheritedProviderScopeã€‚ return _InheritedProviderScope( owner: this, child: builder != null ? Builder( builder: (context) => builder!(context, child), ) : child!, ); } } 1.2 class _InheritedProviderScope å…¶ä¸­éƒ¨åˆ†æ“ä½œä¼šè®©delegateæ¥å®ç°ã€‚åŠŸèƒ½æ›´åŠ çµæ´»ã€‚ class _InheritedProviderScope extends InheritedWidget { const _InheritedProviderScope({ required this.owner, required this.debugType, required Widget child, }) : assert(null is T), super(child: child); final InheritedProvider owner; //å¯¹åº”çš„InheritedProviderã€‚å…¶å®æ˜¯çˆ¶widget //é‡å†™æ­¤æ–¹æ³•ï¼Œæ˜¯å¦é€šçŸ¥æ›´æ–°ä½¿ç”¨InheritedProviderä¼ å…¥çš„updateShouldNotify @override bool updateShouldNotify(InheritedWidget oldWidget) { return false; } //åˆ›å»ºelement @override _InheritedProviderScopeElement createElement() { return _InheritedProviderScopeElement(this); } } class _InheritedProviderScopeElement extends InheritedElement implements InheritedContext { _InheritedProviderScopeElement(_InheritedProviderScope widget) : super(widget); static int _nextProviderId = 0; bool _shouldNotifyDependents = false; bool _debugInheritLocked = false; bool _isNotifyDependentsEnabled = true; bool _updatedShouldNotify = false; bool _isBuildFromExternalSources = false; late final _DelegateState> _delegateState = widget.owner._delegate.createState()..element = this; @override InheritedElement? getElementForInheritedWidgetOfExactType() { InheritedElement? inheritedElement; // å°è¯•åœ¨çˆ¶å¸ƒå±€ä¸­è·å–ç›¸åŒç±»å‹çš„Providerã€‚ visitAncestorElements((parent) { inheritedElement = parent.getElementForInheritedWidgetOfExactType(); return false; }); return inheritedElement; } //æ·»åŠ è§‚å¯Ÿè€… @override void updateDependencies(Element dependent, Object? aspect) { final dependencies = getDependencies(dependent); //å¯ä»¥æŸ¥çœ‹ SelectContext //typedef _SelectorAspect = bool Function(T value); //aspectæ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚åˆ™æ³¨å†Œæˆä¸ºä¸€ä¸ªSelectorç±»å‹çš„è§‚å¯Ÿè€…ã€‚ //é€šè¿‡SelectContextä¸­çš„context.select æ–¹å¼ if (aspect is _SelectorAspect) { //selectorDependencyç›¸å½“äºæ˜¯ä¸€ä¸ªæ–¹æ³•çš„å®¹å™¨ã€‚ final selectorDependency = (dependencies ?? _Dependency()) as _Dependency; selectorDependency.selectors.add(aspect); //å­˜å‚¨è§‚å¯Ÿè€…å¯¹åº”çš„å€¼æ˜¯selectorDependency setDependencies(dependent, selectorDependency); } else { //å­˜å‚¨è§‚å¯Ÿè€…å¯¹åº”çš„å€¼æ˜¯Objectã€‚ setDependencies(dependent, const Object()); } } //é€šçŸ¥ä¾èµ–çš„è§‚å¯Ÿè€…æ‰§è¡Œæ›´æ–° @override void notifyDependent(InheritedWidget oldWidget, Element dependent) { final dependencies = getDependencies(dependent); var shouldNotify = false; if (dependencies != null) { //å¯ä»¥æŸ¥çœ‹ SelectContext //_Dependencyç±»å‹ï¼Œæ‰§è¡Œå­˜å‚¨çš„selectæ–¹æ³•ã€‚ if (dependencies is _Dependency) {...} if (shouldNotify) { //è§‚å¯Ÿè€…æ›´æ–°ã€‚ dependent.didChangeDependencies(); } } @override void update(_InheritedProviderScope newWidget) { _isBuildFromExternalSources = true; //é€šçŸ¥delegateæ‰§è¡Œ willUpdateDelegate _updatedShouldNotify = _delegateState.willUpdateDelegate(newWidget.owner._delegate); super.update(newWidget); _updatedShouldNotify = false; } //å› ä¸ºé‡å†™äº† bool updateShouldNotify(InheritedWidget oldWidget) é€»è¾‘ã€‚ //æ‰€ä»¥è¿™é‡Œé‡å†™updatedã€‚ä½¿ç”¨_updatedShouldNotifyåˆ¤æ–­æ˜¯å¦é€šçŸ¥æ›´æ–° @override void updated(InheritedWidget oldWidget) { super.updated(oldWidget); if (_updatedShouldNotify) { notifyClients(oldWidget); } } @override Widget build() { if (widget.owner._lazy == false) { //éæ‡’åŠ è½½ï¼Œæ‰§è¡Œä¸€æ¬¡getteræ–¹æ³•ã€‚ value; } //é€šçŸ¥ä»£ç†æ‰§è¡Œ build æ–¹æ³•ã€‚ _delegateState.build( isBuildFromExternalSources: _isBuildFromExternalSources, ); _isBuildFromExternalSources = false; //ä»£ç†çš„buildæ–¹æ³•å¯ä»¥å¯¹_shouldNotifyDependentsè¿›è¡Œèµ‹å€¼ï¼Œå†³å®šæ˜¯å¦è¦è°ƒç”¨notifyClients if (_shouldNotifyDependents) { _shouldNotifyDependents = false; notifyClients(widget); } return super.build(); } @override void unmount() { //è°ƒç”¨ä»£ç†çš„dispose _delegateState.dispose(); super.unmount(); } //è·å–valueçš„æ–¹æ³•ï¼Œäº¤ç»™ä»£ç†æ‰§è¡Œã€‚ @override T get value => _delegateState.value; } 1.3. _Delegate _DelegateState 1.3.1 åè®® @immutable abstract class _Delegate { _DelegateState> createState(); void debugFillProperties(DiagnosticPropertiesBuilder properties) {} } abstract class _DelegateState> { _InheritedProviderScopeElement? element; //ç”¨æ¥è·å–provideræŒæœ‰çš„å€¼ T get value; //å…¶å®å°±æ˜¯ _Delegate D get delegate => element!.widget.owner._delegate as D; //æ˜¯å¦æœ‰å€¼ï¼Œå¯¹äº_CreateInheritedProvideræ¥è¯´æ˜¯æ‰§è¡Œäº†createæ–¹æ³•ï¼Œå¯¹äº_ValueInheritedProviderå§‹ç»ˆæ˜¯trueã€‚ bool get hasValue; bool debugSetInheritedLock(bool value) { return element!._debugSetInheritedLock(value); } bool willUpdateDelegate(D newDelegate) => false; //_InheritedProviderScopeElement æ‰§è¡Œ unmountæ–¹æ³•ã€‚ void dispose() {} void debugFillProperties(DiagnosticPropertiesBuilder properties) {} //_InheritedProviderScopeElement æ‰§è¡Œ buildæ–¹æ³• void build({required bool isBuildFromExternalSources}) {} } 1.3.2 _CreateInheritedProvider class _CreateInheritedProvider extends _Delegate { @override _CreateInheritedProviderState createState() => _CreateInheritedProviderState(); } class _CreateInheritedProviderState extends _DelegateState> { ////_InheritedProviderScopeElementçš„ å–å€¼æ“ä½œ è°ƒç”¨è¿™é‡Œã€‚ @override T get value { bool? _debugPreviousIsInInheritedProviderCreate; bool? _debugPreviousIsInInheritedProviderUpdate; //_didInitValue è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–å®ŒæˆValueã€‚å…¶å®å°±æ˜¯æ‰§è¡Œä¸€æ¬¡ get value if (!_didInitValue) { _didInitValue = true; if (delegate.create != null) { //æ‰§è¡Œcreateæ–¹æ³•ï¼Œåˆ›å»ºå€¼ _value = delegate.create!(element!); } if (delegate.update != null) { //æ‰§è¡Œupdateæ–¹æ³•ï¼Œæ›´æ–°å€¼ _value = delegate.update!(element!, _value); } } //è¿”å›å€¼ return _value as T; } //_InheritedProviderScopeElementçš„disposeæ–¹æ³•è°ƒç”¨è¿™é‡Œã€‚ @override void dispose() { super.dispose(); _removeListener?.call(); if (_didInitValue) { //æ‰§è¡Œdisposeæ–¹æ³• delegate.dispose?.call(element!, _value as T); } } //_InheritedProviderScopeElementçš„buildæ–¹æ³•è°ƒç”¨è¿™é‡Œã€‚ @override void build({required bool isBuildFromExternalSources}) { var shouldNotify = false; if (isBuildFromExternalSources && _didInitValue && delegate.update != null) { final previousValue = _value; //é€šè¿‡delegate._updateShouldNotifyæˆ–è€…å‰åå€¼æ˜¯å¦ç›¸ç­‰ _value = delegate.update!(element!, _value as T); //updateå®ç°çš„å‰æä¸‹ if (delegate._updateShouldNotify != null) { shouldNotify = delegate._updateShouldNotify!( previousValue as T, _value as T, ); } else { shouldNotify = _value != previousValue; } } if (shouldNotify) { //è¿™é‡Œç­‰äºtrueã€‚_InheritedProviderScopeElementçš„buildç§ä¼šæ‰§è¡Œ notifyClients(widget); element!._shouldNotifyDependents = true; } } } 1.4 æ€»ç»“ å…¶ä»–ç±»å‹çš„Provideréƒ½æ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¸Šå®ç°çš„ã€‚äº†è§£äº†InheritedProviderå…¶ä»–çš„å°±å¾ˆç®€å•äº†ã€‚ 2. Provider Providerä¸ºInheritedProvideræä¾›äº†.ofæ–¹æ³•ã€‚ä¾¿äºå¿«é€Ÿå–å€¼ class Provider extends InheritedProvider { //æä¾› .of å¿«é€Ÿè·å–valueã€‚ static T of(BuildContext context, {bool listen = true}) { final inheritedElement = _inheritedElementOf(context); if (listen) { context.dependOnInheritedWidgetOfExactType>(); } final value = inheritedElement?.value; return value as T; } static _InheritedProviderScopeElement? _inheritedElementOf( BuildContext context, ) { final inheritedElement = context.getElementForInheritedWidgetOfExactType>() as _InheritedProviderScopeElement?; return inheritedElement; } } 3. ListenableProvider ChangeNotifierProviderç»§æ‰¿è‡ªListenableProviderã€‚å…ˆçœ‹ListenableProvider class ListenableProvider extends InheritedProvider { ListenableProvider({ Key? key, required Create create, Dispose? dispose, bool? lazy, TransitionBuilder? builder, Widget? child, }) : super( key: key, startListening: _startListening, create: create, dispose: dispose, lazy: lazy, builder: builder, child: child, ); //å®ç°äº†startListeningã€‚ static VoidCallback _startListening( InheritedContext e, Listenable? value, ) { //å› ä¸ºæ³›å‹çº¦æŸ //æ‰€ä»¥valueæ·»åŠ ç›‘å¬ã€‚æ–¹æ³•æ˜¯ markNeedsNotifyDependentsã€‚å®ç°å¦‚ä¸‹ value?.addListener(e.markNeedsNotifyDependents); //disposeçš„æ—¶å€™ï¼Œç§»é™¤ç›‘å¬ return () => value?.removeListener(e.markNeedsNotifyDependents); } } class _InheritedProviderScopeElement extends InheritedElement implements InheritedContext { @override //markNeedsNotifyDependentså®ç°ã€‚å…¶å®å°±æ˜¯è°ƒç”¨ markNeedsBuild æ‰§è¡Œåˆ·æ–° void markNeedsNotifyDependents() { if (!_isNotifyDependentsEnabled) { return; } markNeedsBuild(); _shouldNotifyDependents = true; } } 4. ChangeNotifierProvider ChangeNotifierProvideråªæ˜¯ä¿®æ”¹äº†ListenableProviderçš„_disposeæ–¹æ³•ã€‚ class ChangeNotifierProvider extends ListenableProvider { ChangeNotifierProvider({ Key? key, required Create create, bool? lazy, TransitionBuilder? builder, Widget? child, }) : super( key: key, create: create, dispose: _dispose, lazy: lazy, builder: builder, child: child, ); //æ‰§è¡ŒChangeNotifier çš„ dispose static void _dispose(BuildContext context, ChangeNotifier? notifier) { notifier?.dispose(); } } "}}